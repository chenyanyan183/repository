# repository
https://github.com/chenyanyan183/resource.git

发布内容：
	spider：项目代码
	编程书籍评分排行.xls:运行结果
思路：
	首先从总体考虑实现功能有三个部分，一个建立连接，读取页面数据，一个是进行筛选，得到书籍信息，最后一个是将书籍信息生成excel文件
	建立连接使用java自带的UrlConnection建立与服务器之间的联系，通过输入流读取页面信息，这里由于编码问题，需要转换成utf-8，同时考虑可能会有访问限制，所以使用代理，修改访问ip
	这里我考虑在读取过程中进行逻辑判断，通过观察页面源代码，发现不同内容以不同的标签、标签属性或者正则表达式开始，通过String类的contain方法标明flag具体表示的内容类型，在下次或者本次中利用正则获取具体的书籍信息，将信息存放在二维数组中，第一坐标表示第几本书，第二坐标表示书籍的不同的信息。
	在得到信息之后，使用apache的poi来生成excel。
	由于代码使用多线程来提高效率，每个线程读取不同的页面，同时提取具体书籍信息的二维数组，在生成excel的过程中，需要建立一个sheet表，并将数组的数据生成具体的行数据，多个线程同时使用一个sheet表，这里使用单例模式来生成同一个sheet表，提供共享的sheet表，插入不同的数据。
	还有由于线程在生成连接时，需要读取具体的参数，生成url路径，这里需要的参数为start，即从第几本书开始，这里的开始即excel表中的行的数据序号，所以为了达到不重复的目的，在从sheet表中获取开始序号的过程后，还需将最大序列增加一个页面含有的书籍数量，这里会出现一个线程问题，所以需要加锁，使得读和增放在一起，防止在读取完并未增加后，另一线程开始读，造成读取同一页的问题。
	考虑到最后必须所有线程结束后才可以生成excel文件，即执行HSSFWorkbook的write方法，所以设置一个完成量的变量，在线程往sheet添加条数据后，改变完成量，再在每个线程完成添加完成量任务后，判断完成量是否已满，满了就生成excel

所需jia包：
	poi包：poi-3.15.jar和poi-excelant-3.15.jar

类与方法介绍：
	spider类，程序入口，含有一个main方法，内部是成产线程，并执行。线程内是调用getHtml方法，得到含有书籍信息的数组，在调用sheet类的方法添加数据，并打印
	getHtml类，有方法getHtml，功能为使用代理建立连接，读取页面，匹配正则，获取书籍信息。
	Sheet类，含有多个方法，是poi的一些具体实现，采用单例模式生产HSSFSheet表，并在线程获取起始行数的方法中加入了锁

运行时间：
	程序运行时间：3847ms（电脑偏卡，建议自测）
